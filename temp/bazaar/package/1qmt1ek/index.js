"use strict";var pn=Object.defineProperty;var gn=(t,e,n)=>e in t?pn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var N=(t,e,n)=>(gn(t,typeof e!="symbol"?e+"":e,n),n);const v=require("siyuan");let g;function mn(t){g=t}let O;function hn(t){O=t}function kt(t){return t.replaceAll("[","\\[").replaceAll("]","\\]").replaceAll("'","&apos;")}const qt=v.getFrontend(),Xt=qt==="mobile"||qt==="browser-mobile",H="config",_n={icon:!0,depth:0,listType:"unordered",linkType:"ref",docBuilder:!1,autoUpdate:!0,col:1,fold:0};class bn{async initData(){await this.load(),(O.data[H]===""||O.data[H]===void 0||O.data[H]===null)&&await O.saveData(H,JSON.stringify(_n)),await this.load()}set(e,n,i=H){O.data[i][e]=n}get(e,n=H){var i;return(i=O.data[n])==null?void 0:i[e]}async load(e=H){await O.loadData(e)}async save(e=H){await O.saveData(e,O.data[e])}async saveCopy(e=H){await O.saveData(e,O.data[H])}async saveTo(e){O.data[e].docBuilder=O.data[H].docBuilder,await O.saveData(H,O.data[e])}async remove(e=H){await O.removeData(e)}async rename(e,n){await v.fetchSyncPost("/api/file/renameFile",{path:`/data/storage/petal/siyuan-plugins-index/${e}`,newPath:`/data/storage/petal/siyuan-plugins-index/${n}`})}loadSettings(e){this.set("icon",e.icon),this.set("depth",e.depth),this.set("listType",e.listType),this.set("linkType",e.linkType),this.set("fold",e.fold),this.set("col",e.col),this.set("autoUpdate",e.autoUpdate)}}const d=new bn;class yn{constructor(e,n){N(this,"depth");N(this,"text");N(this,"path");N(this,"children");this.depth=e,this.text=n,this.children=new Tt}}class Tt{constructor(){N(this,"stack");N(this,"basePath");N(this,"notebookId");N(this,"pPath");this.stack=[]}push(e){return this.stack.push(e)}pop(){return this.stack.pop()}peek(){if(this.stack.length>0)return this.stack[this.stack.length-1]}clear(){this.stack=[]}isEmpty(){return this.stack.length===0}}class Yt{constructor(e,n){N(this,"depth");N(this,"text");N(this,"children");this.depth=e,this.text=n,this.children=new nt}}class nt{constructor(){N(this,"queue");this.queue=[]}push(e){return this.queue.push(e)}pop(){return this.queue.shift()}getFront(){return this.queue[0]}getRear(){return this.queue[this.queue.length-1]}clear(){this.queue=[]}isEmpty(){return this.queue.length===0}getSize(){return this.queue.length}}let oe;async function Ft(){await d.load();let t=mt();if(t==null){v.showMessage(g.errorMsg_empty,3e3,"error");return}let[e,n]=await St(t),i="";oe=new nt,await it(e,n,oe),i=lt(oe,i),i!=""?await $n(t,i):v.showMessage(g.errorMsg_miss,3e3,"error")}async function wn(t){await d.load();let e=mt();if(e==null){v.showMessage(g.errorMsg_empty,3e3,"error");return}let[n,i]=await St(e),l="";if(oe=new nt,await Sn(n,i,oe),l=lt(oe,l),l!="")await Bn(e,l);else{v.showMessage(g.errorMsg_miss,3e3,"error");return}t.destroy()}async function vn(t){await d.load();let e=mt();if(e==null){v.showMessage(g.errorMsg_empty,3e3,"error");return}let n="",i=await xt(e);if(n=dt(n,i,0),n!="")await v.fetchSyncPost("/api/block/insertBlock",{data:n,dataType:"markdown",parentID:e}),v.showMessage(g.msg_success,3e3,"info");else{v.showMessage(g.errorMsg_miss_outline,3e3,"error");return}t.destroy()}async function kn(t,e,n){await d.load();let i="";oe=new nt,await it(t,n,oe),i=lt(oe,i),i!=""?await tn(e,i):v.showMessage(g.errorMsg_miss,3e3,"error")}async function Tn(t,e,n){var l;await d.load();let i=await v.fetchSyncPost("/api/query/sql",{stmt:`SELECT * FROM blocks WHERE root_id = '${n}' AND ial like '%custom-index-create%' order by updated desc limit 1`});if(((l=i.data[0])==null?void 0:l.id)!=null){let a=(await v.fetchSyncPost("/api/attr/getBlockAttrs",{id:i.data[0].id})).data["custom-index-create"];if(d.loadSettings(JSON.parse(a)),!d.get("autoUpdate"))return;let u="";oe=new nt,await it(t,e,oe),u=lt(oe,u),u!=""?await tn(i.data[0].id,u):v.showMessage(g.errorMsg_miss,3e3,"error")}}async function St(t){let n=(await v.fetchSyncPost("/api/block/getBlockInfo",{id:t})).data,i=n.box,l=n.path;return[i,l]}function mt(){var t,e;return Xt?(t=document.querySelector("#editor .protyle-content .protyle-background"))==null?void 0:t.getAttribute("data-node-id"):(e=document.querySelector(".layout__wnd--active .protyle.fn__flex-1:not(.fn__none) .protyle-background"))==null?void 0:e.getAttribute("data-node-id")}async function Zt(t,e){let i=(await v.fetchSyncPost("/api/filetree/listDocsByPath",{notebook:t,path:e})).data;return i==null?[]:i.files}async function xt(t){let n=(await v.fetchSyncPost("/api/outline/getDocOutline",{id:t})).data;return n??[]}function dt(t,e,n){n++;for(let i of e){let l=i.id,s="";i.depth==0?s=i.name:s=i.content;let a=i.count;for(let f=1;f<n;f++)t+="    ";s=kt(s),d.get("listType")=="unordered"?t+="* ":t+="1. ",d.get("linkType")=="ref"?t+=`[@${s}](siyuan://blocks/${l})
`:t+=`((${l} '@${s}'))
`,a>0&&(i.depth==0?t=dt(t,i.blocks,n):t=dt(t,i.children,n))}return t}function en(t,e){return t==""||t==null?e?"ðŸ“‘":"ðŸ“„":t.indexOf(".")!=-1?t.indexOf("http://")!=-1||t.indexOf("https://")!=-1?e?"ðŸ“‘":"ðŸ“„":`:${t.substring(0,t.lastIndexOf("."))}:`:String.fromCodePoint(parseInt(t,16))}async function Sn(t,e,n,i=0){if(d.get("depth")==0||d.get("depth")>i){let l=await Zt(t,e);i++;for(let s of l){let a="",u=s.id,o=s.name.slice(0,-3),f=s.icon,h=s.subFileCount,_=s.path;for(let re=1;re<i;re++)a+="    ";o=kt(o),d.get("listType")=="unordered"?a+="* ":a+="1. ",d.get("icon")&&(a+=`${en(f,h!=0)} `),d.get("linkType")=="ref"?a+=`[${o}](siyuan://blocks/${u})
`:a+=`((${u} '${o}'))
`;let S=await xt(u);a=dt(a,S,i);let E=new Yt(i,a);n.push(E),h>0&&await it(t,_,E.children,i)}}}async function it(t,e,n,i=0){if(d.get("depth")==0||d.get("depth")>i){let l=await Zt(t,e);i++;for(let s of l){let a="",u=s.id,o=s.name.slice(0,-3),f=s.icon,h=s.subFileCount,_=s.path;for(let E=1;E<i;E++)a+="    ";o=kt(o),d.get("listType")=="unordered"?a+="* ":a+="1. ",d.get("icon")&&(a+=`${en(f,h!=0)} `),d.get("linkType")=="ref"?a+=`[${o}](siyuan://blocks/${u})
`:a+=`((${u} '${o}'))
`;let S=new Yt(i,a);n.push(S),h>0&&await it(t,_,S.children,i)}}}async function $n(t,e){var n;try{let i=await v.fetchSyncPost("/api/query/sql",{stmt:`SELECT * FROM blocks WHERE root_id = '${t}' AND ial like '%custom-index-create%' order by updated desc limit 1`});if(((n=i.data[0])==null?void 0:n.id)==null){let l=await v.fetchSyncPost("/api/block/insertBlock",{data:e,dataType:"markdown",parentID:t});await v.fetchSyncPost("/api/attr/setBlockAttrs",{id:l.data[0].doOperations[0].id,attrs:{"custom-index-create":JSON.stringify(O.data[H])}}),v.showMessage(g.msg_success,3e3,"info")}else{let l=await v.fetchSyncPost("/api/block/updateBlock",{data:e,dataType:"markdown",id:i.data[0].id});await v.fetchSyncPost("/api/attr/setBlockAttrs",{id:l.data[0].doOperations[0].id,attrs:{"custom-index-create":JSON.stringify(O.data[H])}}),v.showMessage(g.update_success,3e3,"info")}}catch{v.showMessage(g.dclike,3e3,"error")}}async function Bn(t,e){await v.fetchSyncPost("/api/block/insertBlock",{data:e,dataType:"markdown",parentID:t}),v.showMessage(g.msg_success,3e3,"info")}async function tn(t,e){let n=await v.fetchSyncPost("/api/block/updateBlock",{data:e,dataType:"markdown",id:t});await v.fetchSyncPost("/api/attr/setBlockAttrs",{id:n.data[0].doOperations[0].id,attrs:{"custom-index-create":JSON.stringify(O.data[H])}})}function lt(t,e){var u;if(((u=t.getFront())==null?void 0:u.depth)==null)return"";let n,i=0,l=0,s=0,a=t.getFront().depth;for(a==1&&d.get("col")!=1&&(e+=`{{{col
`,l=Math.trunc(t.getSize()/d.get("col")),s=d.get("col")-1);!t.isEmpty();){if(i++,n=t.pop(),!n.children.isEmpty()&&d.get("fold")!=0&&d.get("fold")<=n.depth){let o=0;d.get("listType")=="unordered"?(o=n.text.indexOf("*"),n.text=n.text.substring(0,o+2)+'{: fold="1"}'+n.text.substring(o+2)):(o=n.text.indexOf("1"),n.text=n.text.substring(0,o+3)+'{: fold="1"}'+n.text.substring(o+3))}e+=n.text,n.children.isEmpty()||(e=lt(n.children,e)),n.depth==1&&i==l&&s>0&&(e+=`
{: id}
`,i=0,s--)}return a==1&&d.get("col")!=1&&(e+="}}}"),e}function x(){}function nn(t){return t()}function Ut(){return Object.create(null)}function ee(t){t.forEach(nn)}function st(t){return typeof t=="function"}function Qe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Mn(t){return Object.keys(t).length===0}function c(t,e){t.appendChild(e)}function L(t,e,n){t.insertBefore(e,n||null)}function A(t){t.parentNode&&t.parentNode.removeChild(t)}function $t(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function Z(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Be(t){return document.createTextNode(t)}function m(){return Be(" ")}function En(){return Be("")}function D(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function r(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ae(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}function ln(t){return t===""?null:+t}function On(t){return Array.from(t.childNodes)}function ht(t,e){e=""+e,t.data!==e&&(t.data=e)}function $e(t,e){t.value=e??""}function Re(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function pt(t,e,n){for(let i=0;i<t.options.length;i+=1){const l=t.options[i];if(l.__value===e){l.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function sn(t){const e=t.querySelector(":checked");return e&&e.__value}class Dn{constructor(e=!1){N(this,"is_svg",!1);N(this,"e");N(this,"n");N(this,"t");N(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,i=null){this.e||(this.is_svg?this.e=Z(n.nodeName):this.e=p(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)L(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(A)}}let et;function xe(t){et=t}function an(){if(!et)throw new Error("Function called outside component initialization");return et}function Pn(t){an().$$.on_mount.push(t)}function In(t){an().$$.on_destroy.push(t)}const Ge=[],gt=[];let Je=[];const Ht=[],Cn=Promise.resolve();let vt=!1;function Nn(){vt||(vt=!0,Cn.then(on))}function tt(t){Je.push(t)}const wt=new Set;let je=0;function on(){if(je!==0)return;const t=et;do{try{for(;je<Ge.length;){const e=Ge[je];je++,xe(e),Vn(e.$$)}}catch(e){throw Ge.length=0,je=0,e}for(xe(null),Ge.length=0,je=0;gt.length;)gt.pop()();for(let e=0;e<Je.length;e+=1){const n=Je[e];wt.has(n)||(wt.add(n),n())}Je.length=0}while(Ge.length);for(;Ht.length;)Ht.pop()();vt=!1,wt.clear(),xe(t)}function Vn(t){if(t.fragment!==null){t.update(),ee(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(tt)}}function An(t){const e=[],n=[];Je.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),Je=e}const ft=new Set;let Le;function Ln(){Le={r:0,c:[],p:Le}}function Kn(){Le.r||ee(Le.c),Le=Le.p}function I(t,e){t&&t.i&&(ft.delete(t),t.i(e))}function V(t,e,n,i){if(t&&t.o){if(ft.has(t))return;ft.add(t),Le.c.push(()=>{ft.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}function We(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function F(t){t&&t.c()}function K(t,e,n){const{fragment:i,after_update:l}=t.$$;i&&i.m(e,n),tt(()=>{const s=t.$$.on_mount.map(nn).filter(st);t.$$.on_destroy?t.$$.on_destroy.push(...s):ee(s),t.$$.on_mount=[]}),l.forEach(tt)}function q(t,e){const n=t.$$;n.fragment!==null&&(An(n.after_update),ee(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function qn(t,e){t.$$.dirty[0]===-1&&(Ge.push(t),Nn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Xe(t,e,n,i,l,s,a=null,u=[-1]){const o=et;xe(t);const f=t.$$={fragment:null,ctx:[],props:s,update:x,not_equal:l,bound:Ut(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:Ut(),dirty:u,skip_bound:!1,root:e.target||o.$$.root};a&&a(f.root);let h=!1;if(f.ctx=n?n(t,e.props||{},(_,T,...b)=>{const S=b.length?b[0]:T;return f.ctx&&l(f.ctx[_],f.ctx[_]=S)&&(!f.skip_bound&&f.bound[_]&&f.bound[_](S),h&&qn(t,_)),T}):[],f.update(),h=!0,ee(f.before_update),f.fragment=i?i(f.ctx):!1,e.target){if(e.hydrate){const _=On(e.target);f.fragment&&f.fragment.l(_),_.forEach(A)}else f.fragment&&f.fragment.c();e.intro&&I(t.$$.fragment),K(t,e.target,e.anchor),on()}xe(o)}class Ye{constructor(){N(this,"$$");N(this,"$$set")}$destroy(){q(this,1),this.$destroy=x}$on(e,n){if(!st(n))return x;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const l=i.indexOf(n);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!Mn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Fn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Fn);function zt(t,e,n){const i=t.slice();return i[10]=e[n][0],i[11]=e[n][1],i}function Un(t){let e,n,i,l,s,a=t[2].text+"",u,o,f;return{c(){e=p("button"),n=Z("svg"),i=Z("use"),s=m(),u=Be(a),Ae(i,"xlink:href",l=t[2].icon),r(e,"class","b3-button b3-button--outline fn__size200 fn__flex-center"),r(e,"id",t[3]),e.disabled=t[5]},m(h,_){L(h,e,_),c(e,n),c(n,i),c(e,s),c(e,u),o||(f=D(e,"click",function(){st(t[4])&&t[4].apply(this,arguments)}),o=!0)},p(h,_){t=h,_&4&&l!==(l=t[2].icon)&&Ae(i,"xlink:href",l),_&4&&a!==(a=t[2].text+"")&&ht(u,a),_&8&&r(e,"id",t[3]),_&32&&(e.disabled=t[5])},d(h){h&&A(e),o=!1,f()}}}function Hn(t){let e,n,i,l=We(Object.entries(t[2].options)),s=[];for(let a=0;a<l.length;a+=1)s[a]=jt(zt(t,l,a));return{c(){e=p("select");for(let a=0;a<s.length;a+=1)s[a].c();r(e,"class","b3-select fn__flex-center fn__size200"),r(e,"id",t[3]),t[0]===void 0&&tt(()=>t[9].call(e))},m(a,u){L(a,e,u);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null);pt(e,t[0],!0),n||(i=[D(e,"change",t[9]),D(e,"change",t[6])],n=!0)},p(a,u){if(u&4){l=We(Object.entries(a[2].options));let o;for(o=0;o<l.length;o+=1){const f=zt(a,l,o);s[o]?s[o].p(f,u):(s[o]=jt(f),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}u&8&&r(e,"id",a[3]),u&5&&pt(e,a[0])},d(a){a&&A(e),$t(s,a),n=!1,ee(i)}}}function zn(t){let e,n,i;return{c(){e=p("input"),r(e,"class","b3-switch fn__flex-center"),r(e,"id",t[3]),r(e,"type","checkbox")},m(l,s){L(l,e,s),e.checked=t[0],n||(i=[D(e,"change",t[8]),D(e,"change",t[6])],n=!0)},p(l,s){s&8&&r(e,"id",l[3]),s&5&&(e.checked=l[0])},d(l){l&&A(e),n=!1,ee(i)}}}function jn(t){let e,n,i,l,s,a,u;return{c(){e=p("div"),n=p("input"),r(n,"class","b3-slider fn__size200"),r(n,"id",t[3]),r(n,"type","range"),r(n,"min",i=t[2].min),r(n,"max",l=t[2].max),r(n,"step",s=t[2].step),r(e,"class","b3-tooltips b3-tooltips__n fn__flex-center"),r(e,"aria-label",t[0])},m(o,f){L(o,e,f),c(e,n),$e(n,t[0]),a||(u=[D(n,"change",t[7]),D(n,"input",t[7]),D(n,"change",t[6])],a=!0)},p(o,f){f&8&&r(n,"id",o[3]),f&4&&i!==(i=o[2].min)&&r(n,"min",i),f&4&&l!==(l=o[2].max)&&r(n,"max",l),f&4&&s!==(s=o[2].step)&&r(n,"step",s),f&5&&$e(n,o[0]),f&5&&r(e,"aria-label",o[0])},d(o){o&&A(e),a=!1,ee(u)}}}function jt(t){let e,n=t[11]+"",i,l;return{c(){e=p("option"),i=Be(n),e.__value=l=t[10],$e(e,e.__value)},m(s,a){L(s,e,a),c(e,i)},p(s,a){a&4&&n!==(n=s[11]+"")&&ht(i,n),a&4&&l!==(l=s[10])&&(e.__value=l,$e(e,e.__value))},d(s){s&&A(e)}}}function Gn(t){let e,n,i,l=t[2].title+"",s,a,u=t[2].content+"",o,f,h;function _(S,E){if(S[1]==="range")return jn;if(S[1]==="switch")return zn;if(S[1]==="select")return Hn;if(S[1]==="button")return Un}let T=_(t),b=T&&T(t);return{c(){e=p("label"),n=p("div"),i=new Dn(!1),s=m(),a=p("div"),o=m(),f=p("span"),h=m(),b&&b.c(),i.a=s,r(a,"class","b3-label__text"),r(n,"class","fn__flex-1"),r(f,"class","fn__space"),r(e,"class","fn__flex b3-label config__item")},m(S,E){L(S,e,E),c(e,n),i.m(l,n),c(n,s),c(n,a),a.innerHTML=u,c(e,o),c(e,f),c(e,h),b&&b.m(e,null)},p(S,[E]){E&4&&l!==(l=S[2].title+"")&&i.p(l),E&4&&u!==(u=S[2].content+"")&&(a.innerHTML=u),T===(T=_(S))&&b?b.p(S,E):(b&&b.d(1),b=T&&T(S),b&&(b.c(),b.m(e,null)))},i:x,o:x,d(S){S&&A(e),b&&b.d()}}}function Rn(t,e,n){let{type:i}=e,{content:l}=e,{settingKey:s}=e,{settingValue:a}=e,{onMyClick:u=function(){}}=e,{disabled:o=null}=e;function f(){d.set(s,a),d.save()}function h(){a=ln(this.value),n(0,a),n(2,l)}function _(){a=this.checked,n(0,a),n(2,l)}function T(){a=sn(this),n(0,a),n(2,l)}return t.$$set=b=>{"type"in b&&n(1,i=b.type),"content"in b&&n(2,l=b.content),"settingKey"in b&&n(3,s=b.settingKey),"settingValue"in b&&n(0,a=b.settingValue),"onMyClick"in b&&n(4,u=b.onMyClick),"disabled"in b&&n(5,o=b.disabled)},[a,i,l,s,u,o,f,h,_,T]}class he extends Ye{constructor(e){super(),Xe(this,e,Rn,Gn,Qe,{type:1,content:2,settingKey:3,settingValue:0,onMyClick:4,disabled:5})}}function Gt(t,e,n){const i=t.slice();return i[9]=e[n][0],i[10]=e[n][1],i}function Jn(t){let e,n,i,l=We(Object.entries(t[2].options)),s=[];for(let a=0;a<l.length;a+=1)s[a]=Rt(Gt(t,l,a));return{c(){e=p("select");for(let a=0;a<s.length;a+=1)s[a].c();r(e,"class","b3-select fn__flex-center fn__size200"),r(e,"id",t[3]),t[0]===void 0&&tt(()=>t[8].call(e))},m(a,u){L(a,e,u);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null);pt(e,t[0],!0),n||(i=[D(e,"change",t[8]),D(e,"change",t[4])],n=!0)},p(a,u){if(u&4){l=We(Object.entries(a[2].options));let o;for(o=0;o<l.length;o+=1){const f=Gt(a,l,o);s[o]?s[o].p(f,u):(s[o]=Rt(f),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}u&8&&r(e,"id",a[3]),u&5&&pt(e,a[0])},d(a){a&&A(e),$t(s,a),n=!1,ee(i)}}}function Wn(t){let e,n,i;return{c(){e=p("input"),r(e,"class","b3-switch fn__flex-center"),r(e,"id",t[3]),r(e,"type","checkbox")},m(l,s){L(l,e,s),e.checked=t[0],n||(i=[D(e,"change",t[7]),D(e,"change",t[4])],n=!0)},p(l,s){s&8&&r(e,"id",l[3]),s&5&&(e.checked=l[0])},d(l){l&&A(e),n=!1,ee(i)}}}function Qn(t){let e,n,i,l,s,a,u;return{c(){e=p("div"),n=p("input"),r(n,"class","b3-slider fn__size200"),r(n,"id",t[3]),r(n,"type","range"),r(n,"min",i=t[2].min),r(n,"max",l=t[2].max),r(n,"step",s=t[2].step),r(e,"class","b3-tooltips b3-tooltips__n fn__flex-center"),r(e,"aria-label",t[0])},m(o,f){L(o,e,f),c(e,n),$e(n,t[0]),a||(u=[D(n,"change",t[6]),D(n,"input",t[6]),D(n,"change",t[4])],a=!0)},p(o,f){f&8&&r(n,"id",o[3]),f&4&&i!==(i=o[2].min)&&r(n,"min",i),f&4&&l!==(l=o[2].max)&&r(n,"max",l),f&4&&s!==(s=o[2].step)&&r(n,"step",s),f&5&&$e(n,o[0]),f&5&&r(e,"aria-label",o[0])},d(o){o&&A(e),a=!1,ee(u)}}}function Rt(t){let e,n=t[10]+"",i,l;return{c(){e=p("option"),i=Be(n),e.__value=l=t[9],$e(e,e.__value)},m(s,a){L(s,e,a),c(e,i)},p(s,a){a&4&&n!==(n=s[10]+"")&&ht(i,n),a&4&&l!==(l=s[9])&&(e.__value=l,$e(e,e.__value))},d(s){s&&A(e)}}}function Xn(t){let e,n,i=t[2].title+"",l,s;function a(f,h){if(f[1]==="range")return Qn;if(f[1]==="switch")return Wn;if(f[1]==="select")return Jn}let u=a(t),o=u&&u(t);return{c(){e=p("div"),n=p("div"),l=Be(i),s=m(),o&&o.c(),r(n,"class","fn__flex-1 fn__flex-center"),r(e,"class","fn__flex")},m(f,h){L(f,e,h),c(e,n),c(n,l),c(e,s),o&&o.m(e,null)},p(f,[h]){h&4&&i!==(i=f[2].title+"")&&ht(l,i),u===(u=a(f))&&o?o.p(f,h):(o&&o.d(1),o=u&&u(f),o&&(o.c(),o.m(e,null)))},i:x,o:x,d(f){f&&A(e),o&&o.d()}}}function Yn(t,e,n){let{type:i}=e,{content:l}=e,{settingKey:s}=e,{settingValue:a}=e,{name:u}=e;function o(){d.set(s,a,u),d.save(u)}function f(){a=ln(this.value),n(0,a),n(2,l)}function h(){a=this.checked,n(0,a),n(2,l)}function _(){a=sn(this),n(0,a),n(2,l)}return t.$$set=T=>{"type"in T&&n(1,i=T.type),"content"in T&&n(2,l=T.content),"settingKey"in T&&n(3,s=T.settingKey),"settingValue"in T&&n(0,a=T.settingValue),"name"in T&&n(5,u=T.name)},[a,i,l,s,o,u,f,h,_]}class Ve extends Ye{constructor(e){super(),Xe(this,e,Yn,Xn,Qe,{type:1,content:2,settingKey:3,settingValue:0,name:5})}}class Zn{constructor(){N(this,"events");this.events={}}on(e,n){this.events[e]||(this.events[e]=[]),this.events[e].push(n)}off(e,n){if(!this.events[e])return;const i=this.events[e].indexOf(n);i>=0&&this.events[e].splice(i,1)}emit(e,...n){this.events[e]&&this.events[e].forEach(i=>{i.apply(this,n)})}once(e,n){function i(...l){n.apply(this,l),this.off(e,i)}this.on(e,i)}}let ve=new Zn;function xn(t){let e,n,i,l,s,a,u,o,f,h,_,T,b,S,E,re,y,R,_e,be,ce,z,Me,U,ue,J,te,fe,ye,ne,j,M,ie,le,se,ke,B,W,Q,Ke,de,pe,X,qe,we;return R=new Ve({props:{type:"select",content:g.settingsTab.items.listType,settingKey:"listType",settingValue:d.get("listType",t[0]),name:t[0]}}),z=new Ve({props:{type:"select",content:g.settingsTab.items.linkType,settingKey:"linkType",settingValue:d.get("linkType",t[0]),name:t[0]}}),J=new Ve({props:{type:"switch",content:g.settingsTab.items.icon,settingKey:"icon",settingValue:d.get("icon",t[0]),name:t[0]}}),ne=new Ve({props:{type:"range",content:g.settingsTab.items.depth,settingKey:"depth",settingValue:d.get("depth",t[0]),name:t[0]}}),le=new Ve({props:{type:"range",content:g.settingsTab.items.fold,settingKey:"fold",settingValue:d.get("fold",t[0]),name:t[0]}}),W=new Ve({props:{type:"range",content:g.settingsTab.items.col,settingKey:"col",settingValue:d.get("col",t[0]),name:t[0]}}),pe=new Ve({props:{type:"switch",content:g.settingsTab.items.autoUpdate,settingKey:"autoUpdate",settingValue:d.get("autoUpdate",t[0]),name:t[0]}}),{c(){e=p("label"),n=p("div"),i=p("div"),i.textContent=`${t[2]}`,l=m(),s=p("div"),a=m(),u=p("span"),u.innerHTML='<svg><use xlink:href="#iconSelect"></use></svg>',o=m(),f=p("div"),h=m(),_=p("span"),_.innerHTML='<svg><use xlink:href="#iconTrashcan"></use></svg>',T=m(),b=p("div"),S=m(),E=p("div"),re=m(),y=p("div"),F(R.$$.fragment),_e=m(),be=p("div"),ce=m(),F(z.$$.fragment),Me=m(),U=p("div"),ue=m(),F(J.$$.fragment),te=m(),fe=p("div"),ye=m(),F(ne.$$.fragment),j=m(),M=p("div"),ie=m(),F(le.$$.fragment),se=m(),ke=p("div"),B=m(),F(W.$$.fragment),Q=m(),Ke=p("div"),de=m(),F(pe.$$.fragment),Re(i,"font-weight","bold"),r(s,"class","fn__flex-1 fn__space"),r(u,"class","b3-tooltips b3-tooltips__sw block__icon block__icon--show"),r(u,"data-type","switch"),r(u,"aria-label",g.useTemplate),r(f,"class","fn__space"),r(_,"aria-label",g.deleteTemplate),r(_,"class","b3-tooltips b3-tooltips__sw block__icon block__icon--show"),r(n,"class","fn__flex"),r(b,"class","fn__hr"),r(E,"class","fn__hr"),r(be,"class","fn__hr"),r(U,"class","fn__hr"),r(fe,"class","fn__hr"),r(M,"class","fn__hr"),r(ke,"class","fn__hr"),r(Ke,"class","fn__hr"),r(y,"class","fn_flex"),Re(y,"flex-direction","column"),r(e,"class","fn__flex b3-label config__item"),Re(e,"flex-direction","column"),r(e,"id",t[0])},m(k,P){L(k,e,P),c(e,n),c(n,i),c(n,l),c(n,s),c(n,a),c(n,u),c(n,o),c(n,f),c(n,h),c(n,_),c(e,T),c(e,b),c(e,S),c(e,E),c(e,re),c(e,y),K(R,y,null),c(y,_e),c(y,be),c(y,ce),K(z,y,null),c(y,Me),c(y,U),c(y,ue),K(J,y,null),c(y,te),c(y,fe),c(y,ye),K(ne,y,null),c(y,j),c(y,M),c(y,ie),K(le,y,null),c(y,se),c(y,ke),c(y,B),K(W,y,null),c(y,Q),c(y,Ke),c(y,de),K(pe,y,null),t[5](e),X=!0,qe||(we=[D(u,"click",t[4]),D(_,"click",t[3])],qe=!0)},p(k,[P]){const ge={};P&1&&(ge.settingValue=d.get("listType",k[0])),P&1&&(ge.name=k[0]),R.$set(ge);const Ee={};P&1&&(Ee.settingValue=d.get("linkType",k[0])),P&1&&(Ee.name=k[0]),z.$set(Ee);const Fe={};P&1&&(Fe.settingValue=d.get("icon",k[0])),P&1&&(Fe.name=k[0]),J.$set(Fe);const ae={};P&1&&(ae.settingValue=d.get("depth",k[0])),P&1&&(ae.name=k[0]),ne.$set(ae);const Oe={};P&1&&(Oe.settingValue=d.get("fold",k[0])),P&1&&(Oe.name=k[0]),le.$set(Oe);const De={};P&1&&(De.settingValue=d.get("col",k[0])),P&1&&(De.name=k[0]),W.$set(De);const Ue={};P&1&&(Ue.settingValue=d.get("autoUpdate",k[0])),P&1&&(Ue.name=k[0]),pe.$set(Ue),(!X||P&1)&&r(e,"id",k[0])},i(k){X||(I(R.$$.fragment,k),I(z.$$.fragment,k),I(J.$$.fragment,k),I(ne.$$.fragment,k),I(le.$$.fragment,k),I(W.$$.fragment,k),I(pe.$$.fragment,k),X=!0)},o(k){V(R.$$.fragment,k),V(z.$$.fragment,k),V(J.$$.fragment,k),V(ne.$$.fragment,k),V(le.$$.fragment,k),V(W.$$.fragment,k),V(pe.$$.fragment,k),X=!1},d(k){k&&A(e),q(R),q(z),q(J),q(ne),q(le),q(W),q(pe),t[5](null),qe=!1,ee(we)}}}function ei(t,e,n){let{name:i}=e,l,s=i.substring(9);function a(){d.remove(i),l.parentNode.remove(),ve.emit("addTemplateNone")}async function u(){d.saveTo(i),v.showMessage(g.templateUsed,3e3,"info")}function o(f){gt[f?"unshift":"push"](()=>{l=f,n(1,l)})}return t.$$set=f=>{"name"in f&&n(0,i=f.name)},[i,l,s,a,u,o]}class rn extends Ye{constructor(e){super(),Xe(this,e,ei,xn,Qe,{name:0})}}function ti(t){let e,n,i=g.nothasTemplate+"",l,s,a,u,o;return{c(){e=p("div"),n=p("div"),l=Be(i),s=m(),a=p("a"),a.textContent=`${g.cliketoAdd}`,r(n,"class","b3-label b3-label--inner"),r(e,"class","b3-label")},m(f,h){L(f,e,h),c(e,n),c(n,l),c(n,s),c(n,a),u||(o=D(a,"click",t[0]),u=!0)},p:x,i:x,o:x,d(f){f&&A(e),u=!1,o()}}}function ni(t){return[()=>{ve.emit("switchTab","normal"),console.log("switchTab")}]}class ii extends Ye{constructor(e){super(),Xe(this,e,ni,ti,Qe,{})}}function Jt(t,e,n){const i=t.slice();return i[34]=e[n][0],i}function li(t){let e,n,i,l;return n=new rn({props:{name:t[34]}}),{c(){e=p("div"),F(n.$$.fragment),i=m()},m(s,a){L(s,e,a),K(n,e,null),c(e,i),l=!0},p:x,i(s){l||(I(n.$$.fragment,s),l=!0)},o(s){V(n.$$.fragment,s),l=!1},d(s){s&&A(e),q(n)}}}function Wt(t){let e,n,i=t[34]!="config"&&li(t);return{c(){i&&i.c(),e=En()},m(l,s){i&&i.m(l,s),L(l,e,s),n=!0},p(l,s){l[34]!="config"&&i.p(l,s)},i(l){n||(I(i),n=!0)},o(l){V(i),n=!1},d(l){l&&A(e),i&&i.d(l)}}}function si(t){let e,n,i,l,s,a,u,o,f,h,_,T,b,S,E,re,y,R,_e,be,ce,z,Me,U,ue,J,te,fe,ye,ne,j,M,ie,le,se,ke,B,W,Q,Ke,de,pe,X,qe,we,k,P,ge,Ee,Fe,ae,Oe,De,Ue,fn=g.settingsTab.items.createTemplate+"",Bt,at,Mt,Te,ot,Et,He,ze,rt,Ot,me,ct,Ze,Dt,Pe,Pt,Ie,ut,Y,_t,It;ie=new he({props:{type:"select",content:g.settingsTab.items.listType,settingKey:"listType",settingValue:t[9]}}),se=new he({props:{type:"select",content:g.settingsTab.items.linkType,settingKey:"linkType",settingValue:t[10]}}),B=new he({props:{type:"switch",content:g.settingsTab.items.icon,settingKey:"icon",settingValue:t[7]}}),Q=new he({props:{type:"range",content:g.settingsTab.items.depth,settingKey:"depth",settingValue:t[8]}}),de=new he({props:{type:"range",content:g.settingsTab.items.fold,settingKey:"fold",settingValue:t[12]}}),X=new he({props:{type:"range",content:g.settingsTab.items.col,settingKey:"col",settingValue:t[11]}}),we=new he({props:{type:"switch",content:g.settingsTab.items.autoUpdate,settingKey:"autoUpdate",settingValue:t[15]}});let Ce=We(Object.entries(O.data)),C=[];for(let w=0;w<Ce.length;w+=1)C[w]=Wt(Jt(t,Ce,w));const dn=w=>V(C[w],1,1,()=>{C[w]=null});return ze=new he({props:{type:"switch",content:g.settingsTab.items.docBuilder,settingKey:"docBuilder",settingValue:t[14]}}),Pe=new he({props:{type:"button",content:g.settingsTab.items.subOutlineButton,settingKey:"subOutlineButton",settingValue:"",onMyClick:t[0],disabled:t[6]}}),Ie=new he({props:{type:"button",content:g.settingsTab.items.docOutlineButton,settingKey:"docOutlineButton",settingValue:"",onMyClick:t[1],disabled:t[6]}}),{c(){e=p("div"),n=p("ul"),i=p("li"),l=Z("svg"),s=Z("use"),a=m(),u=p("span"),u.textContent=`${g.generalSettings}`,f=m(),h=p("li"),_=Z("svg"),T=Z("use"),b=m(),S=p("span"),S.textContent=`${g.templateSettings}`,re=m(),y=p("li"),R=Z("svg"),_e=Z("use"),be=m(),ce=p("span"),ce.textContent=`${g.extraSettings}`,Me=m(),U=p("li"),ue=Z("svg"),J=Z("use"),te=m(),fe=p("span"),fe.textContent=`${g.independentInsert}`,ne=m(),j=p("div"),M=p("div"),F(ie.$$.fragment),le=m(),F(se.$$.fragment),ke=m(),F(B.$$.fragment),W=m(),F(Q.$$.fragment),Ke=m(),F(de.$$.fragment),pe=m(),F(X.$$.fragment),qe=m(),F(we.$$.fragment),k=m(),P=p("label"),ge=p("div"),Ee=p("div"),Fe=m(),ae=p("button"),Oe=Z("svg"),De=Z("use"),Ue=m(),Bt=Be(fn),Mt=m(),Te=p("div");for(let w=0;w<C.length;w+=1)C[w].c();Et=m(),He=p("div"),F(ze.$$.fragment),Ot=m(),me=p("div"),ct=p("div"),Ze=p("div"),Dt=m(),F(Pe.$$.fragment),Pt=m(),F(Ie.$$.fragment),Ae(s,"xlink:href","#iconSettings"),r(l,"class","b3-list-item__graphic"),r(u,"class","b3-list-item__text"),r(i,"data-name","normal"),r(i,"class",o=t[13]==="normal"?"b3-list-item--focus b3-list-item":"b3-list-item"),Ae(T,"xlink:href","#iconBazaar"),r(_,"class","b3-list-item__graphic"),r(S,"class","b3-list-item__text"),r(h,"data-name","template"),r(h,"class",E=t[13]==="template"?"b3-list-item--focus b3-list-item":"b3-list-item"),Ae(_e,"xlink:href","#iconList"),r(R,"class","b3-list-item__graphic"),r(ce,"class","b3-list-item__text"),r(y,"data-name","extra"),r(y,"class",z=t[13]==="extra"?"b3-list-item--focus b3-list-item":"b3-list-item"),Ae(J,"xlink:href","#iconEdit"),r(ue,"class","b3-list-item__graphic"),r(fe,"class","b3-list-item__text"),r(U,"data-name","individual"),r(U,"class",ye=t[13]==="individual"?"b3-list-item--focus b3-list-item":"b3-list-item"),r(n,"class","b3-tab-bar b3-list b3-list--background"),r(Ee,"class","fn__flex-1"),Ae(De,"xlink:href","#iconAdd"),r(ae,"class","b3-button b3-button--outline fn__flex-center fn__size200"),r(ae,"id","createtemplate"),r(ge,"class","fn__flex"),r(P,"class","fn__flex b3-label config__item"),Re(P,"flex-direction","column"),r(M,"data-name","normal"),r(M,"class",at=t[13]==="normal"?"config__tab-container":"config__tab-container fn__none"),r(Te,"data-name","template"),r(Te,"class",ot=t[13]==="template"?"config__tab-container":"config__tab-container fn__none"),r(He,"data-name","extra"),r(He,"class",rt=t[13]==="extra"?"config__tab-container":"config__tab-container fn__none"),r(Ze,"class","b3-label b3-label--inner"),r(ct,"class","b3-label"),r(me,"data-name","individual"),r(me,"class",ut=t[13]==="individual"?"config__tab-container":"config__tab-container fn__none"),r(j,"class","config__tab-wrap"),r(e,"class","fn__flex-1 fn__flex config__panel")},m(w,$){L(w,e,$),c(e,n),c(n,i),c(i,l),c(l,s),c(i,a),c(i,u),c(n,f),c(n,h),c(h,_),c(_,T),c(h,b),c(h,S),c(n,re),c(n,y),c(y,R),c(R,_e),c(y,be),c(y,ce),c(n,Me),c(n,U),c(U,ue),c(ue,J),c(U,te),c(U,fe),c(e,ne),c(e,j),c(j,M),K(ie,M,null),c(M,le),K(se,M,null),c(M,ke),K(B,M,null),c(M,W),K(Q,M,null),c(M,Ke),K(de,M,null),c(M,pe),K(X,M,null),c(M,qe),K(we,M,null),c(M,k),c(M,P),c(P,ge),c(ge,Ee),c(ge,Fe),c(ge,ae),c(ae,Oe),c(Oe,De),c(ae,Ue),c(ae,Bt),c(j,Mt),c(j,Te);for(let Ne=0;Ne<C.length;Ne+=1)C[Ne]&&C[Ne].m(Te,null);t[20](Te),c(j,Et),c(j,He),K(ze,He,null),c(j,Ot),c(j,me),c(me,ct),c(ct,Ze),Ze.innerHTML=t[4],c(me,Dt),K(Pe,me,null),c(me,Pt),K(Ie,me,null),Y=!0,_t||(It=[D(i,"click",t[16]),D(h,"click",t[17]),D(y,"click",t[18]),D(U,"click",t[19]),D(ae,"click",function(){st(t[2])&&t[2].apply(this,arguments)})],_t=!0)},p(w,$){t=w,(!Y||$[0]&8192&&o!==(o=t[13]==="normal"?"b3-list-item--focus b3-list-item":"b3-list-item"))&&r(i,"class",o),(!Y||$[0]&8192&&E!==(E=t[13]==="template"?"b3-list-item--focus b3-list-item":"b3-list-item"))&&r(h,"class",E),(!Y||$[0]&8192&&z!==(z=t[13]==="extra"?"b3-list-item--focus b3-list-item":"b3-list-item"))&&r(y,"class",z),(!Y||$[0]&8192&&ye!==(ye=t[13]==="individual"?"b3-list-item--focus b3-list-item":"b3-list-item"))&&r(U,"class",ye);const Ne={};$[0]&512&&(Ne.settingValue=t[9]),ie.$set(Ne);const Ct={};$[0]&1024&&(Ct.settingValue=t[10]),se.$set(Ct);const Nt={};$[0]&128&&(Nt.settingValue=t[7]),B.$set(Nt);const Vt={};$[0]&256&&(Vt.settingValue=t[8]),Q.$set(Vt);const At={};$[0]&4096&&(At.settingValue=t[12]),de.$set(At);const Lt={};if($[0]&2048&&(Lt.settingValue=t[11]),X.$set(Lt),(!Y||$[0]&8192&&at!==(at=t[13]==="normal"?"config__tab-container":"config__tab-container fn__none"))&&r(M,"class",at),$&0){Ce=We(Object.entries(O.data));let G;for(G=0;G<Ce.length;G+=1){const Kt=Jt(t,Ce,G);C[G]?(C[G].p(Kt,$),I(C[G],1)):(C[G]=Wt(Kt),C[G].c(),I(C[G],1),C[G].m(Te,null))}for(Ln(),G=Ce.length;G<C.length;G+=1)dn(G);Kn()}(!Y||$[0]&8192&&ot!==(ot=t[13]==="template"?"config__tab-container":"config__tab-container fn__none"))&&r(Te,"class",ot),(!Y||$[0]&8192&&rt!==(rt=t[13]==="extra"?"config__tab-container":"config__tab-container fn__none"))&&r(He,"class",rt),(!Y||$[0]&16)&&(Ze.innerHTML=t[4]);const bt={};$[0]&1&&(bt.onMyClick=t[0]),$[0]&64&&(bt.disabled=t[6]),Pe.$set(bt);const yt={};$[0]&2&&(yt.onMyClick=t[1]),$[0]&64&&(yt.disabled=t[6]),Ie.$set(yt),(!Y||$[0]&8192&&ut!==(ut=t[13]==="individual"?"config__tab-container":"config__tab-container fn__none"))&&r(me,"class",ut)},i(w){if(!Y){I(ie.$$.fragment,w),I(se.$$.fragment,w),I(B.$$.fragment,w),I(Q.$$.fragment,w),I(de.$$.fragment,w),I(X.$$.fragment,w),I(we.$$.fragment,w);for(let $=0;$<Ce.length;$+=1)I(C[$]);I(ze.$$.fragment,w),I(Pe.$$.fragment,w),I(Ie.$$.fragment,w),Y=!0}},o(w){V(ie.$$.fragment,w),V(se.$$.fragment,w),V(B.$$.fragment,w),V(Q.$$.fragment,w),V(de.$$.fragment,w),V(X.$$.fragment,w),V(we.$$.fragment,w),C=C.filter(Boolean);for(let $=0;$<C.length;$+=1)V(C[$]);V(ze.$$.fragment,w),V(Pe.$$.fragment,w),V(Ie.$$.fragment,w),Y=!1},d(w){w&&A(e),q(ie),q(se),q(B),q(Q),q(de),q(X),q(we),$t(C,w),t[20](null),q(ze),q(Pe),q(Ie),_t=!1,ee(It)}}}function ai(t,e,n){let{onSubOutlineButton:i=function(){}}=e,{onDocOutlineButton:l=function(){}}=e,{onCreateTemplateButton:s=function(){}}=e,{onGetTemplate:a=function(){}}=e,u,o,f=mt(),h=null;f==null?(h="disabled",u=g.noneId):u=g.hadId;let _=d.get("icon"),T=d.get("depth"),b=d.get("listType"),S=d.get("linkType"),E=d.get("docBuilder"),re=d.get("col"),y=d.get("fold"),R=d.get("autoUpdate"),_e=_??!0,be=T??0,ce=b??"unordered",z=S??"ref",Me=E??!1,U=re??1,ue=y??0,J=_==null?!0:R,te="normal";async function fe(){await d.load(),n(7,_e=d.get("icon")),n(8,be=d.get("depth")),n(9,ce=d.get("listType")),n(10,z=d.get("linkType")),n(11,U=d.get("col")),n(12,ue=d.get("fold"))}ve.on("updateSettings",fe);function ye(B){let W=document.getElementById("templatenone");W&&W.remove();let Q=document.createElement("div");new rn({target:Q,props:{name:B}}),o.appendChild(Q)}ve.on("addTemplate",ye);function ne(B){n(13,te=B)}ve.on("switchTab",ne);function j(){if(console.log(o.children.length),o.children.length==0){let B=document.createElement("div");B.id="templatenone",new ii({target:B}),o.appendChild(B)}}ve.on("addTemplateNone",j),Pn(()=>{ve.emit("addTemplateNone")}),In(()=>{d.save()});const M=()=>{n(13,te="normal"),ve.emit("updateSettings")},ie=()=>{n(13,te="template"),a()},le=()=>n(13,te="extra"),se=()=>n(13,te="individual");function ke(B){gt[B?"unshift":"push"](()=>{o=B,n(5,o)})}return t.$$set=B=>{"onSubOutlineButton"in B&&n(0,i=B.onSubOutlineButton),"onDocOutlineButton"in B&&n(1,l=B.onDocOutlineButton),"onCreateTemplateButton"in B&&n(2,s=B.onCreateTemplateButton),"onGetTemplate"in B&&n(3,a=B.onGetTemplate)},[i,l,s,a,u,o,h,_e,be,ce,z,U,ue,te,Me,J,M,ie,le,se,ke]}class oi extends Ye{constructor(e){super(),Xe(this,e,ai,si,Qe,{onSubOutlineButton:0,onDocOutlineButton:1,onCreateTemplateButton:2,onGetTemplate:3},null,[-1,-1])}}function ri(t){let e,n,i,l,s,a;return{c(){e=p("label"),e.innerHTML='<div class="fn__flex-1"><input id="template-name" class="b3-text-field fn__flex-center fn__size200"/></div>',n=m(),i=p("div"),l=p("button"),l.textContent=`${g.settingsTab.items.templateDialog.save}`,r(e,"class","fn__flex b3-label config__item"),r(l,"id","saveDraw"),r(l,"class","b3-button"),r(i,"class","button-group"),Re(i,"float","right"),Re(i,"margin","20px 0 10px")},m(u,o){L(u,e,o),L(u,n,o),L(u,i,o),c(i,l),s||(a=D(l,"click",function(){st(t[0])&&t[0].apply(this,arguments)}),s=!0)},p(u,[o]){t=u},i:x,o:x,d(u){u&&(A(e),A(n),A(i)),s=!1,a()}}}function ci(t,e,n){let{onSave:i=function(){}}=e;return t.$$set=l=>{"onSave"in l&&n(0,i=l.onSave)},[i]}class ui extends Ye{constructor(e){super(),Xe(this,e,ci,ri,Qe,{onSave:0})}}async function fi(){di()}function di(){const t="index-get-template-name",e=new v.Dialog({title:g.settingsTab.items.templateDialog.title,content:`<div id="${t}" class="b3-dialog__content">`,width:"300px"});let n=e.element.querySelector(`#${t}`);new ui({target:n,props:{onSave:()=>{pi(e)}}})}async function pi(t){let e=t.element.querySelector("#template-name");if(e.value==""){v.showMessage(g.templateNameEepty,3e3,"error");return}else{let i=(await v.fetchSyncPost("/api/file/readDir",{path:"/data/storage/petal/siyuan-plugins-index"})).data;for(const l of i)if(l.name.indexOf("template-"+e.value)!=-1){v.showMessage(g.templateAgain,3e3,"error");return}await d.saveCopy("template-"+e.value),ve.emit("addTemplate","template-"+e.value)}t.destroy(),v.showMessage(g.templateCreated,3e3,"info")}async function Qt(){let e=(await v.fetchSyncPost("/api/file/readDir",{path:"/data/storage/petal/siyuan-plugins-index"})).data;for(const n of e)n.name.startsWith("template-")&&await d.load(n.name)}async function gi(){const t=O.addTopBar({icon:"iconList",title:g.addTopBarIcon,position:"right",callback:async()=>{Ft()}});O.addCommand({langKey:"addTopBarIcon",hotkey:"âŒ¥âŒ˜I",callback:async()=>{Ft()}}),t.addEventListener("contextmenu",async()=>{await mi()})}async function mi(){await d.load(),await Qt();const t="index-settings",e=new v.Dialog({title:g.settingsTab.name,content:`<div id="${t}" class="fn__flex-1 fn__flex config__panel">`,width:"70%",height:"70%"});let n=e.element.querySelector(`#${t}`);new oi({target:n,props:{onSubOutlineButton:()=>{wn(e)},onDocOutlineButton:()=>{vn(e)},onCreateTemplateButton:()=>{fi()},onGetTemplate:()=>{Qt()}}})}let Se;function hi({detail:t}){t.blockElements.length>1||t.blockElements[0].getAttribute("data-type")!="NodeList"||!d.get("docBuilder")||t.menu.addItem({icon:"iconList",label:g.settingsTab.items.docBuilder.title,click:async()=>{await _i(t)}})}async function _i(t){Se=new Tt,Se.notebookId=t.protyle.notebookId;let e=t.blockElements[0].getAttribute("data-node-id"),n=t.blockElements[0].childNodes;Se.basePath=await bi(e);let i=await St(t.protyle.block.rootID);Se.pPath=i[1].slice(0,-3),await cn(n,Se),await un(Se),await kn(Se.notebookId,e,i[1])}async function cn(t,e,n=0){n++;let i;for(const l of t)if(l.getAttribute("data-type")=="NodeListItem"){let s=l.childNodes;for(const a of s)if(a.getAttribute("data-type")=="NodeParagraph"){let u=window.Lute.BlockDOM2Content(a.innerHTML),o=new yn(n,u);e.push(o),i=o.children}else a.getAttribute("data-type")=="NodeList"&&await cn(a.childNodes,i,n)}}async function bi(t){let n=(await v.fetchSyncPost("/api/query/sql",{stmt:`SELECT * FROM blocks WHERE id = '${t}'`})).data[0];return n==null?void 0:n.hpath}async function yi(t,e){return(await v.fetchSyncPost("/api/filetree/createDocWithMd",{notebook:t,path:e,markdown:""})).data}async function un(t){let e,n=new Tt;for(;!t.isEmpty();){e=t.pop();let i=e.text,l=t.basePath+"/"+i;e.path=await yi(Se.notebookId,l),e.path=t.pPath+"/"+e.path,n.push(e),e.children.isEmpty()||(e.children.basePath=l,e.children.pPath=e.path,un(e.children))}n.pPath=t.pPath}function wi({detail:t}){if(!Xt&&t.protyle.block.showAll)return;let e=t.protyle.notebookId,n=t.protyle.path,i=t.protyle.block.rootID;Tn(e,n,i)}class vi extends v.Plugin{async onload(){console.log("IndexPlugin onload"),this.init(),await gi(),await d.initData(),this.eventBus.on("click-blockicon",hi),this.eventBus.on("loaded-protyle-static",wi)}onunload(){console.log("IndexPlugin onunload")}init(){mn(this.i18n),hn(this)}}module.exports=vi;
